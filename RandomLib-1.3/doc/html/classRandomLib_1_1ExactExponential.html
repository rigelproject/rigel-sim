<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>RandomLib: RandomLib::ExactExponential&lt; bits &gt; Class Template Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">RandomLib</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="namespaceRandomLib.html">RandomLib</a>      </li>
      <li class="navelem"><a class="el" href="classRandomLib_1_1ExactExponential.html">ExactExponential</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">RandomLib::ExactExponential&lt; bits &gt; Class Template Reference</div>  </div>
</div>
<div class="contents">
<!-- doxytag: class="RandomLib::ExactExponential" -->
<p>Sample exactly from an exponential distribution.  
 <a href="classRandomLib_1_1ExactExponential.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="ExactExponential_8hpp_source.html">RandomLib/ExactExponential.hpp</a>&gt;</code></p>

<p><a href="classRandomLib_1_1ExactExponential-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memTemplParams" colspan="2">template&lt;class Random &gt; </td></tr>
<tr><td class="memTemplItemLeft" align="right" valign="top"><a class="el" href="classRandomLib_1_1RandomNumber.html">RandomNumber</a>&lt; bits &gt;&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classRandomLib_1_1ExactExponential.html#ad85bf107686f61fe22dc008b5295340f">operator()</a> (<a class="el" href="classRandomLib_1_1RandomCanonical.html">Random</a> &amp;r) const </td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><h3>template&lt;int bits = 1&gt;<br/>
class RandomLib::ExactExponential&lt; bits &gt;</h3>

<p>Sample exactly from an exponential distribution. </p>
<p>Sample <em>x</em> &gt;= 0 from exp(-<em>x</em>). See:</p>
<ul>
<li>J. von Neumann, Various Techniques used in Connection with Random Digits, J. Res. Nat. Bur. Stand., Appl. Math. Ser. 12, 36-38 (1951), reprinted in Collected Works, Vol. 5, 768-770 (Pergammon, 1963).</li>
<li>M. Abramowitz and I. A. Stegun, Handbook of Mathematical Functions (National Bureau of Standards, 1964), Sec. 26.8.6.c.2.</li>
<li>G. E. Forsythe, Von Neumann's Comparison Method for Random Sampling from Normal and Other Distributions, Math. Comp. 26, 817-826 (1972).</li>
<li>D. E. Knuth, TAOCP, Vol 2, Sec 3.4.1.C.3.</li>
<li>D. E. Knuth and A. C. Yao, The Complexity of Nonuniform Random Number Generation, in "Algorithms and Complexity" (Academic Press, 1976), pp. 357-428.</li>
<li>P. Flajolet and N. Saheb, The Complexity of Generating an Exponentially Distributed Variate, J. Algorithms 7, 463-488 (1986).</li>
</ul>
<p>The following code illustrates the basic method given by von Neumann: </p>
<div class="fragment"><pre class="fragment"><span class="comment">// Return a random number x &gt;= 0 distributed with probability exp(-x).</span>
<span class="keywordtype">double</span> ExpDist(<a class="code" href="classRandomLib_1_1RandomCanonical.html" title="Generate random integers, reals, and booleans.">RandomLib::Random</a>&amp; r) {
  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> k = 0; ; ++k) {
    <span class="keywordtype">double</span> x = r.<a class="code" href="classRandomLib_1_1RandomCanonical.html#a7dde483cd76f2e4bb75d378b54c64468">Fixed</a>(),       <span class="comment">// executed 1/(1-exp(-1)) times on average</span>
      p = x, q;
    <span class="keywordflow">do</span> {
      q = r.<a class="code" href="classRandomLib_1_1RandomCanonical.html#a7dde483cd76f2e4bb75d378b54c64468">Fixed</a>();            <span class="comment">// executed exp(x)*cosh(x) times on average</span>
      <span class="keywordflow">if</span> (!(q &lt; p)) <span class="keywordflow">return</span> k + x;
      p = r.<a class="code" href="classRandomLib_1_1RandomCanonical.html#a7dde483cd76f2e4bb75d378b54c64468">Fixed</a>();            <span class="comment">// executed exp(x)*sinh(x) times on average</span>
    } <span class="keywordflow">while</span> (p &lt; q);
  }
}
</pre></div><p> This returns a result consuming exp(1)/(1 - exp(-1)) = 4.30 random numbers on average. (Von Neumann incorrectly states that the method takes (1 + exp(1))/(1 - exp(-1)) = 5.88 random numbers on average.) Because of the finite precision of <a class="el" href="classRandomLib_1_1RandomCanonical.html#a7dde483cd76f2e4bb75d378b54c64468">Random::Fixed()</a>, the code snippet above only approximates exp(-<em>x</em>). Instead, it returns <em>x</em> with probability <em>h</em>(1 - <em>h</em>)<sup><em>x</em>/<em>h</em></sup> for <em>x</em> = <em>ih</em>, <em>h</em> = 2<sup>-53</sup>, and integer <em>i</em> &gt;= 0.</p>
<p>The above is precisely von Neumann's method. Abramowitz and Stegun consider a variant: sample uniform variants until the first is less than the sum of the rest. Forsythe converts the &lt; ranking for the runs to &lt;= which makes the analysis of the discrete case more difficult. He also drops the "trick" by which the integer part of the deviate is given by the number of rejections when finding the fractional part.</p>
<p>Von Neumann says of his method: "The machine has in effect computed a logarithm by performing only discriminations on the relative magnitude of numbers in (0,1). It is a sad fact of life, however, that under the particular conditions of the Eniac it was slightly quicker to use a truncated power series for log(1-<em>T</em>) than to carry out all the discriminations."</p>
<p>Here the method is extended to use infinite precision uniform deviates implemented by <a class="el" href="classRandomLib_1_1RandomNumber.html" title="Infinite precision random numbers.">RandomNumber</a> and returning <em>exact</em> results for the exponential distribution. This is possible because only comparisons are done in the method. The template parameter <em>bits</em> specifies the number of bits in the base used for <a class="el" href="classRandomLib_1_1RandomNumber.html" title="Infinite precision random numbers.">RandomNumber</a> (i.e., base = 2<sup><em>bits</em></sup>).</p>
<p>For example the following samples from an exponential distribution and prints various representations of the result. </p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;<a class="code" href="RandomNumber_8hpp.html" title="Header for RandomNumber.">RandomLib/RandomNumber.hpp</a>&gt;</span>
<span class="preprocessor">#include &lt;<a class="code" href="ExactExponential_8hpp.html" title="Header for ExactExponential.">RandomLib/ExactExponential.hpp</a>&gt;</span>

  <a class="code" href="classRandomLib_1_1RandomCanonical.html" title="Generate random integers, reals, and booleans.">RandomLib::Random</a> r;
  <span class="keyword">const</span> <span class="keywordtype">int</span> bits = 1;
  <a class="code" href="classRandomLib_1_1ExactExponential.html" title="Sample exactly from an exponential distribution.">RandomLib::ExactExponential&lt;bits&gt;</a> edist;
  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; 10; ++i) {
    <a class="code" href="classRandomLib_1_1RandomNumber.html" title="Infinite precision random numbers.">RandomLib::RandomNumber&lt;bits&gt;</a> x = edist(r); <span class="comment">// Sample</span>
    std::pair&lt;double, double&gt; z = x.<a class="code" href="classRandomLib_1_1RandomNumber.html#a0801e21e273b52fc66074bc49fced7ec">Range</a>();
    std::cout &lt;&lt; x &lt;&lt; <span class="stringliteral">&quot; = &quot;</span>     <span class="comment">// Print in binary with ellipsis</span>
              &lt;&lt; <span class="stringliteral">&quot;(&quot;</span> &lt;&lt; z.first &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; z.second &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>; <span class="comment">// Print range</span>
    <span class="keywordtype">double</span> v = x.<a class="code" href="classRandomLib_1_1RandomNumber.html#aa9458469dccb2033cb248745da78bc28">Value</a>&lt;<span class="keywordtype">double</span>&gt;(r); <span class="comment">// Round exactly to nearest double</span>
    std::cout &lt;&lt; <span class="stringliteral">&quot; = &quot;</span> &lt;&lt; v &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
  }
</pre></div><p> Here's a possible result: </p>
<div class="fragment"><pre class="fragment">
   0.0111... = (0.4375,0.5) = 0.474126
   10.000... = (2,2.125) = 2.05196
   1.00... = (1,1.25) = 1.05766
   0.010... = (0.25,0.375) = 0.318289
   10.1... = (2.5,3) = 2.8732
   0.0... = (0,0.5) = 0.30753
   0.101... = (0.625,0.75) = 0.697654
   0.00... = (0,0.25) = 0.0969214
   0.0... = (0,0.5) = 0.194053
   0.11... = (0.75,1) = 0.867946
</pre></div><p> First number is in binary with ... indicating an infinite sequence of random bits. Second number gives the corresponding interval. Third number is the result of filling in the missing bits and rounding exactly to the nearest representable double.</p>
<p>This class uses some mutable <a class="el" href="classRandomLib_1_1RandomNumber.html" title="Infinite precision random numbers.">RandomNumber</a> objects. So a single <a class="el" href="classRandomLib_1_1ExactExponential.html" title="Sample exactly from an exponential distribution.">ExactExponential</a> object cannot safely be used by multiple threads. In a multi-processing environment, each thread should use a thread-specific <a class="el" href="classRandomLib_1_1ExactExponential.html" title="Sample exactly from an exponential distribution.">ExactExponential</a> object. In addition, these should be invoked with thread-specific random generator objects.</p>
<dl><dt><b>Template Parameters:</b></dt><dd>
  <table class="">
    <tr><td class="paramname">bits</td><td>the number of bits in each digit. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ExactExponential_8hpp_source.html#l00125">125</a> of file <a class="el" href="ExactExponential_8hpp_source.html">ExactExponential.hpp</a>.</p>
</div><hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="ad85bf107686f61fe22dc008b5295340f"></a><!-- doxytag: member="RandomLib::ExactExponential::operator()" ref="ad85bf107686f61fe22dc008b5295340f" args="(Random &amp;r) const " -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;int bits&gt; </div>
<div class="memtemplate">
template&lt;class Random &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classRandomLib_1_1RandomNumber.html">RandomNumber</a>&lt; bits &gt; <a class="el" href="classRandomLib_1_1ExactExponential.html">RandomLib::ExactExponential</a>&lt; bits &gt;::operator() </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classRandomLib_1_1RandomCanonical.html">Random</a> &amp;&#160;</td>
          <td class="paramname"><em>r</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Return a random deviate with an exponential distribution, exp(-<em>x</em>) for <em>x</em> &gt;= 0. Requires 9.316 bits per invocation for <em>bits</em> = 1, 6.03 digits for <em>bits</em> = 2, 5.06 digits for <em>bits</em> = 3, and 4.30 = exp(1)/(1 - exp(-1)) digits for large <em>bits</em>. The frequency of bits in the fractional part of the returned result with <em>bits</em> = 1:<br/>
 </p>
<div class="fragment"><pre class="fragment">
     bits freq(%)
      1   47.98
      2   25.50
      3   13.13
      4    6.66
      5    3.36
      6    1.68
      7    0.84
      8    0.42
      9    0.21
     10    0.11
     11    0.05
     12    0.03
     13+   0.03
</pre></div><p> The average number of bits in the fraction = 2.054. The frequency table of <em>bits</em> &gt; 1 can be generated from the table above. E.g., with <em>bits</em> = 2, the result consists of three digits with frequency 3.36% + 1.68% = 5.04%. The relative frequency of the results for the fractional part with <em>bits</em> = 1 is shown by the histogram<br/>
 </p>
<div class="image">
<img src="exphist.png" alt="exphist.png" width="580" height="750" alt="exact binary sampling of exponential distribution"/>
</div>
<p><br/>
 The base of each rectangle gives the range represented by the corresponding binary number and the area is proportional to its frequency. A PDF version of this figure is given <a href="exphist.pdf">here</a>. This allows the figure to be magnified to show the rectangles for all binary numbers up to 9 bits.</p>
<p>Another way of assessing the efficiency of the algorithm is thru the mean value of the balance = (number of random bits consumed) - (number of bits in the result). If we code the result in mixed unary-binary notation (integer is given in unary, followed by "0" as a separator, followed by the fraction in binary), then the mean balance is 5.680.</p>
<dl><dt><b>Template Parameters:</b></dt><dd>
  <table class="">
    <tr><td class="paramname">Random</td><td>the type of the random generator. </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">r</td><td>a random generator. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>the random sample. </dd></dl>

<p>Definition at line <a class="el" href="ExactExponential_8hpp_source.html#l00189">189</a> of file <a class="el" href="ExactExponential_8hpp_source.html">ExactExponential.hpp</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="ExactExponential_8hpp_source.html">ExactExponential.hpp</a></li>
</ul>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Sat Jan 21 2012 for RandomLib by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
