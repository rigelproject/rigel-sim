<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>RandomLib: RandomLib::ExactNormal&lt; bits &gt; Class Template Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">RandomLib</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="namespaceRandomLib.html">RandomLib</a>      </li>
      <li class="navelem"><a class="el" href="classRandomLib_1_1ExactNormal.html">ExactNormal</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">RandomLib::ExactNormal&lt; bits &gt; Class Template Reference</div>  </div>
</div>
<div class="contents">
<!-- doxytag: class="RandomLib::ExactNormal" -->
<p>Sample exactly from a normal distribution.  
 <a href="classRandomLib_1_1ExactNormal.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="ExactNormal_8hpp_source.html">RandomLib/ExactNormal.hpp</a>&gt;</code></p>

<p><a href="classRandomLib_1_1ExactNormal-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memTemplParams" colspan="2">template&lt;class Random &gt; </td></tr>
<tr><td class="memTemplItemLeft" align="right" valign="top"><a class="el" href="classRandomLib_1_1RandomNumber.html">RandomNumber</a>&lt; bits &gt;&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classRandomLib_1_1ExactNormal.html#ad7a3060b8276202bc6405d1aa893a2d6">operator()</a> (<a class="el" href="classRandomLib_1_1RandomCanonical.html">Random</a> &amp;r) const </td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><h3>template&lt;int bits = 1&gt;<br/>
class RandomLib::ExactNormal&lt; bits &gt;</h3>

<p>Sample exactly from a normal distribution. </p>
<p>Sample <em>x</em> from exp(-<em>x</em><sup>2</sup>/2) / sqrt(2 pi). For background, see:</p>
<ul>
<li>J. von Neumann, Various Techniques used in Connection with Random Digits, J. Res. Nat. Bur. Stand., Appl. Math. Ser. 12, 36-38 (1951), reprinted in Collected Works, Vol. 5, 768-770 (Pergammon, 1963).</li>
<li>D. E. Knuth and A. C. Yao, The Complexity of Nonuniform Random Number Generation, in "Algorithms and Complexity" (Academic Press, 1976), pp. 357-428.</li>
<li>P. Flajolet and N. Saheb, The Complexity of Generating an Exponentially Distributed Variate, J. Algorithms 7, 463-488 (1986).</li>
</ul>
<p>The algorithm is as follows:</p>
<ol type="1">
<li>Select an integer <em>k</em> &gt;= 0 with probability exp(-<em>k</em>/2) (1-exp(-1/2)).</li>
<li>Accept with probability exp(- <em>k</em> (<em>k</em> - 1) / 2); otherwise, reject and start over at step 1.</li>
<li>Sample a random number <em>x</em> uniformly from [0,1).</li>
<li>Accept with probability exp(- <em>x</em> (<em>x</em> + 2<em>k</em>) / 2); otherwise, reject and start over at step 1.</li>
<li>Set <em>x</em> = <em>k</em> + <em>x</em>.</li>
<li>With probability 1/2, negate <em>x</em>.</li>
<li>Return <em>x</em>.</li>
</ol>
<p>It is easy to show that this algorithm returns samples from the normal distribution with zero mean and unit variance. Futhermore, all these steps can be carried out exactly as follows:</p>
<ul>
<li>Step 1:<ul>
<li><em>k</em> = 0;</li>
<li>while (ExpProb(-1/2)) increment <em>k</em> by 1.</li>
</ul>
</li>
<li>Step 2:<ul>
<li><em>n</em> = <em>k</em> (<em>k</em> - 1) / 2;</li>
<li>while (<em>n</em> &gt; 0) { if (!ExpProb(-1/2)) go to step 1; decrement <em>n</em> by 1; }</li>
</ul>
</li>
<li>Step 4:<ul>
<li>repeat <em>k</em> + 1 times: if (!ExpProb(- <em>x</em> (<em>x</em> + 2<em>k</em>) / (2<em>k</em> + 2))) go to step 1.</li>
</ul>
</li>
</ul>
<p>Here, ExpProb(-<em>p</em>) returns true with probability exp(-<em>p</em>). With <em>p</em> = 1/2 (steps 1 and 2), this is implemented with von Neumann's rejection technique:</p>
<ul>
<li>Generate a sequence of random numbers <em>U</em><sub><em>i</em></sub> and find the greatest <em>n</em> such that 1/2 &gt; <em>U</em><sub>1</sub> &gt; <em>U</em><sub>2</sub> &gt; . . . &gt; <em>U</em><sub><em>n</em></sub>. (The resulting value of <em>n</em> may be 0.)</li>
<li>If <em>n</em> is even, accept and return true; otherwise (<em>n</em> odd), reject and return false.</li>
</ul>
<p>For <em>p</em> = <em>x</em> (<em>x</em> + 2<em>k</em>) / (2<em>k</em> + 2) (step 4), we generalize von Neumann's procedure as follows:</p>
<ul>
<li>Generate two sequences of random numbers <em>U</em><sub><em>i</em></sub> and <em>V</em><sub><em>i</em></sub> and find the greatest <em>n</em> such that both the following conditions hold<ul>
<li><em>x</em> &gt; <em>U</em><sub>1</sub> &gt; <em>U</em><sub>2</sub> &gt; . . . &gt; <em>U</em><sub><em>n</em></sub>;</li>
<li><em>x</em> + 2 <em>k</em> &gt; (2 <em>k</em> + 2) <em>V</em><sub><em>i</em></sub> for all <em>i</em> in [1, <em>n</em>].</li>
</ul>
(The resulting value of <em>n</em> may be 0.)</li>
<li>If <em>n</em> is even, accept (return true); otherwise (<em>n</em> odd), reject (return false).</li>
</ul>
<p>Here, instead of testing <em>x</em> + 2 <em>k</em> &gt; (2 <em>k</em> + 2) <em>V</em><sub><em>i</em></sub>, we carry out the following tests:</p>
<ul>
<li>return true, with probability 2 <em>k</em> / (2 <em>k</em> + 2);</li>
<li>return false, with probability 1 / (2 <em>k</em> + 2);</li>
<li>otherwise (also with probability 1 / (2 <em>k</em> + 2)), return <em>x</em> &gt; <em>V</em><sub><em>i</em></sub>.</li>
</ul>
<p>The resulting method now entails evaluation of simple fractional probabilities (e.g., 1 / (2 <em>k</em> + 2)), or comparing random numbers (e.g., <em>U</em><sub>1</sub> &gt; <em>U</em><sub>2</sub>). These may be carried out exactly with a finite mean running time.</p>
<p>With <em>bits</em> = 1, this consumes 30.0 digits on average and the result has 1.56 digits in the fraction. It takes about 676 ns to generate a result (1460 ns, including the time to round it to a double). With bits = 32, it takes 437 ns to generate a result (621 ns, including the time to round it to a double). In contrast, <a class="el" href="classRandomLib_1_1NormalDistribution.html" title="Normal deviates.">NormalDistribution</a> takes about 44 ns to generate a double result.</p>
<p>Another way of assessing the efficiency of the algorithm is thru the mean value of the balance = (number of random bits consumed) - (number of bits in the result). If we code the result in Knuth &amp; Yao's unary-binary notation, then the mean balance is 26.1.</p>
<p>For example the following samples from a normal exponential distribution and prints various representations of the result. </p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;<a class="code" href="RandomNumber_8hpp.html" title="Header for RandomNumber.">RandomLib/RandomNumber.hpp</a>&gt;</span>
<span class="preprocessor">#include &lt;<a class="code" href="ExactNormal_8hpp.html" title="Header for ExactNormal.">RandomLib/ExactNormal.hpp</a>&gt;</span>

  <a class="code" href="classRandomLib_1_1RandomCanonical.html" title="Generate random integers, reals, and booleans.">RandomLib::Random</a> r;
  <span class="keyword">const</span> <span class="keywordtype">int</span> bits = 1;
  <a class="code" href="classRandomLib_1_1ExactNormal.html" title="Sample exactly from a normal distribution.">RandomLib::ExactNormal&lt;bits&gt;</a> ndist;
  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; 10; ++i) {
    <a class="code" href="classRandomLib_1_1RandomNumber.html" title="Infinite precision random numbers.">RandomLib::RandomNumber&lt;bits&gt;</a> x = ndist(r); <span class="comment">// Sample</span>
    std::pair&lt;double, double&gt; z = x.<a class="code" href="classRandomLib_1_1RandomNumber.html#a0801e21e273b52fc66074bc49fced7ec">Range</a>();
    std::cout &lt;&lt; x &lt;&lt; <span class="stringliteral">&quot; = &quot;</span>     <span class="comment">// Print in binary with ellipsis</span>
              &lt;&lt; <span class="stringliteral">&quot;(&quot;</span> &lt;&lt; z.first &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; z.second &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>; <span class="comment">// Print range</span>
    <span class="keywordtype">double</span> v = x.<a class="code" href="classRandomLib_1_1RandomNumber.html#aa9458469dccb2033cb248745da78bc28">Value</a>&lt;<span class="keywordtype">double</span>&gt;(r); <span class="comment">// Round exactly to nearest double</span>
    std::cout &lt;&lt; <span class="stringliteral">&quot; = &quot;</span> &lt;&lt; v &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
  }
</pre></div><p> Here's a possible result: </p>
<div class="fragment"><pre class="fragment">
-1.00... = (-1.25,-1) = -1.02142
-0.... = (-1,0) = -0.319708
0.... = (0,1) = 0.618735
-0.0... = (-0.5,0) = -0.396591
0.0... = (0,0.5) = 0.20362
0.0... = (0,0.5) = 0.375662
-1.111... = (-2,-1.875) = -1.88295
-1.10... = (-1.75,-1.5) = -1.68088
-0.... = (-1,0) = -0.577547
-0.... = (-1,0) = -0.890553
</pre></div><p> First number is in binary with ... indicating an infinite sequence of random bits. Second number gives the corresponding interval. Third number is the result of filling in the missing bits and rounding exactly to the nearest representable double.</p>
<p>This class uses some mutable <a class="el" href="classRandomLib_1_1RandomNumber.html" title="Infinite precision random numbers.">RandomNumber</a> objects. So a single <a class="el" href="classRandomLib_1_1ExactNormal.html" title="Sample exactly from a normal distribution.">ExactNormal</a> object cannot safely be used by multiple threads. In a multi-processing environment, each thread should use a thread-specific <a class="el" href="classRandomLib_1_1ExactNormal.html" title="Sample exactly from a normal distribution.">ExactNormal</a> object. In addition, these should be invoked with thread-specific random generator objects.</p>
<dl><dt><b>Template Parameters:</b></dt><dd>
  <table class="">
    <tr><td class="paramname">bits</td><td>the number of bits in each digit. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ExactNormal_8hpp_source.html#l00154">154</a> of file <a class="el" href="ExactNormal_8hpp_source.html">ExactNormal.hpp</a>.</p>
</div><hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="ad7a3060b8276202bc6405d1aa893a2d6"></a><!-- doxytag: member="RandomLib::ExactNormal::operator()" ref="ad7a3060b8276202bc6405d1aa893a2d6" args="(Random &amp;r) const " -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;int bits&gt; </div>
<div class="memtemplate">
template&lt;class Random &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classRandomLib_1_1RandomNumber.html">RandomNumber</a>&lt; bits &gt; <a class="el" href="classRandomLib_1_1ExactNormal.html">RandomLib::ExactNormal</a>&lt; bits &gt;::operator() </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classRandomLib_1_1RandomCanonical.html">Random</a> &amp;&#160;</td>
          <td class="paramname"><em>r</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Return a random deviate with a normal distribution of mean 0 and variance 1.</p>
<dl><dt><b>Template Parameters:</b></dt><dd>
  <table class="">
    <tr><td class="paramname">Random</td><td>the type of the random generator. </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">r</td><td>a random generator. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>the random sample. </dd></dl>

<p>Definition at line <a class="el" href="ExactNormal_8hpp_source.html#l00289">289</a> of file <a class="el" href="ExactNormal_8hpp_source.html">ExactNormal.hpp</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="ExactNormal_8hpp_source.html">ExactNormal.hpp</a></li>
</ul>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Sat Jan 21 2012 for RandomLib by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
