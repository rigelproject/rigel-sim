<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>RandomLib: Saving and restoring the state</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">RandomLib</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">Saving and restoring the state </div>  </div>
</div>
<div class="contents">
<div class="textblock"><center> Back to <a class="el" href="otherdist.html">Other random distributions</a>. Forward to <a class="el" href="programming.html">Programming tips</a>. Up to <a class="el" href="index.html#contents">Contents</a>. </center><p>A Random can be copied, saved, and restored in a variety of ways as illustrated here by <a class="el" href="RandomSave_8cpp.html" title="Examples of saving and restore the state with RandomLib.">RandomSave.cpp</a></p>
<div class="fragment"><pre class="fragment"><span class="comment">/**</span>
<span class="comment"> * \file RandomSave.cpp</span>
<span class="comment"> * \brief Examples of saving and restore the state with %RandomLib</span>
<span class="comment"> *</span>
<span class="comment"> * Compile/link with, e.g.,\n</span>
<span class="comment"> * g++ -DHAVE_BOOST_SERIALIZATION -I../include -O2 -funroll-loops</span>
<span class="comment"> *   -lboost_serialization-mt -o RandomSave RandomSave.cpp ../src/Random.cpp\n</span>
<span class="comment"> * ./RandomSave</span>
<span class="comment"> *</span>
<span class="comment"> * $Id: c06f2e696d28a1c5c42df87e39d8bd87fb1d96dc $</span>
<span class="comment"> *</span>
<span class="comment"> * See \ref save, for more information.</span>
<span class="comment"> *</span>
<span class="comment"> * Copyright (c) Charles Karney (2011) &lt;charles@karney.com&gt; and licensed under</span>
<span class="comment"> * the MIT/X11 License.  For more information, see</span>
<span class="comment"> * http://randomlib.sourceforge.net/</span>
<span class="comment"> **********************************************************************/</span>

<span class="preprocessor">#include &lt;iostream&gt;</span>
<span class="preprocessor">#include &lt;fstream&gt;</span>
<span class="preprocessor">#include &lt;string&gt;</span>
<span class="preprocessor">#if HAVE_BOOST_SERIALIZATION</span>
<span class="preprocessor"></span><span class="preprocessor">#if defined(_MSC_VER)</span>
<span class="preprocessor"></span><span class="comment">// Squelch warnings about argument conversion and unchecked parameters with</span>
<span class="comment">// boost serialization</span>
<span class="preprocessor">#pragma warning (disable: 4244 4996)</span>
<span class="preprocessor"></span><span class="preprocessor">#endif</span>
<span class="preprocessor"></span><span class="preprocessor">#include &lt;boost/archive/xml_iarchive.hpp&gt;</span>
<span class="preprocessor">#include &lt;boost/archive/xml_oarchive.hpp&gt;</span>
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="Random_8hpp.html" title="Header for Random, RandomGenerator.">RandomLib/Random.hpp</a>&gt;</span>

<span class="keywordtype">int</span> <a class="code" href="RandomCoverage_8cpp.html#a2c3f6775325c30275d11c6abee2db6a0">main</a>(<span class="keywordtype">int</span>, <span class="keywordtype">char</span>**) {
  <span class="keywordtype">int</span> retval = 0;
  <span class="keywordtype">long</span> step = 1000000;
  <a class="code" href="classRandomLib_1_1RandomCanonical.html" title="Generate random integers, reals, and booleans.">RandomLib::Random</a> r; r.Reseed();
  std::cout &lt;&lt; <span class="stringliteral">&quot;Using &quot;</span> &lt;&lt; r.Name() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
            &lt;&lt; <span class="stringliteral">&quot;with seed &quot;</span> &lt;&lt; r.SeedString() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
  r.StepCount(step);            <span class="comment">// use r</span>
  {
    std::cout &lt;&lt; <span class="stringliteral">&quot;Test save and restore with copy constructor... &quot;</span>;
    <a class="code" href="classRandomLib_1_1RandomCanonical.html" title="Generate random integers, reals, and booleans.">RandomLib::Random</a> s(r);     <span class="comment">// copy r&#39;s state into s via copy constructor</span>
    r.StepCount(step); s.StepCount(step); <span class="comment">// step both generators forward</span>
    std::cout &lt;&lt; (r == s &amp;&amp; r() == s()
                  ? <span class="stringliteral">&quot;succeeded\n&quot;</span> : (retval = 1, <span class="stringliteral">&quot;failed\n&quot;</span>));
  }
  {
    std::cout &lt;&lt; <span class="stringliteral">&quot;Test save state via count... &quot;</span>;
    <span class="keywordtype">long</span> <span class="keywordtype">long</span> savecount = r.Count(); <span class="comment">// save the count</span>
    <span class="keywordtype">double</span> d = r.<a class="code" href="classRandomLib_1_1RandomCanonical.html#a7dde483cd76f2e4bb75d378b54c64468">Fixed</a>();            <span class="comment">// save a random result</span>
    r.StepCount(step);               <span class="comment">// step r forward</span>
    r.SetCount(savecount);           <span class="comment">// restore to saved count</span>
    std::cout &lt;&lt; (d == r.<a class="code" href="classRandomLib_1_1RandomCanonical.html#a7dde483cd76f2e4bb75d378b54c64468">Fixed</a>()
                  ? <span class="stringliteral">&quot;succeeded\n&quot;</span> : (retval = 1, <span class="stringliteral">&quot;failed\n&quot;</span>));
  }
  {
    std::cout &lt;&lt; <span class="stringliteral">&quot;Test save state via seed and count... &quot;</span>;
    <a class="code" href="classRandomLib_1_1RandomCanonical.html" title="Generate random integers, reals, and booleans.">RandomLib::Random</a> s(r.Seed()); <span class="comment">// constructor with r&#39;s seed</span>
    s.SetCount(r.Count());         <span class="comment">// advance s with r&#39;s count</span>
    r.StepCount(step); s.StepCount(step); <span class="comment">// step both generators forward</span>
    std::cout &lt;&lt; (r == s &amp;&amp; r() == s()
                  ? <span class="stringliteral">&quot;succeeded\n&quot;</span> : (retval = 1, <span class="stringliteral">&quot;failed\n&quot;</span>));
  }
  {
    std::cout &lt;&lt; <span class="stringliteral">&quot;Test save state to file in portable binary format... &quot;</span>;
    {
      std::ofstream f(<span class="stringliteral">&quot;rand.bin&quot;</span>, std::ios::binary);
      r.Save(f);                <span class="comment">// save r in binary mode to rand.bin</span>
    }
    <a class="code" href="classRandomLib_1_1RandomCanonical.html" title="Generate random integers, reals, and booleans.">RandomLib::Random</a> s(0);
    {
      std::ifstream f(<span class="stringliteral">&quot;rand.bin&quot;</span>, std::ios::binary);
      s.Load(f);                <span class="comment">// load saved state to s</span>
    }
    r.StepCount(step); s.StepCount(step); <span class="comment">// step both generators forward</span>
    std::cout &lt;&lt; (r == s &amp;&amp; r() == s()
                  ? <span class="stringliteral">&quot;succeeded\n&quot;</span> : (retval = 1, <span class="stringliteral">&quot;failed\n&quot;</span>));
  }
  {
    std::cout &lt;&lt; <span class="stringliteral">&quot;Test save state to file in text format... &quot;</span>;
    {
      std::ofstream f(<span class="stringliteral">&quot;rand.txt&quot;</span>);
      f &lt;&lt; <span class="stringliteral">&quot;Random number state:\n&quot;</span> &lt;&lt; r &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>; <span class="comment">// save r with operator&lt;&lt;</span>
    }
    <a class="code" href="classRandomLib_1_1RandomCanonical.html" title="Generate random integers, reals, and booleans.">RandomLib::Random</a> s(0);
    {
      std::ifstream f(<span class="stringliteral">&quot;rand.txt&quot;</span>);
      std::string str;
      std::getline(f, str);     <span class="comment">// skip over first line</span>
      f &gt;&gt; s;                   <span class="comment">// read into s with operator&gt;&gt;</span>
    }
    r.StepCount(step); s.StepCount(step); <span class="comment">// step both generators forward</span>
    std::cout &lt;&lt; (r == s &amp;&amp; r() == s()
                  ? <span class="stringliteral">&quot;succeeded\n&quot;</span> : (retval = 1, <span class="stringliteral">&quot;failed\n&quot;</span>));
  }
  {
<span class="preprocessor">#if HAVE_BOOST_SERIALIZATION</span>
<span class="preprocessor"></span>    std::cout &lt;&lt; <span class="stringliteral">&quot;Test save state to file in boost xml format... &quot;</span>;
    {
      std::ofstream f(<span class="stringliteral">&quot;rand.xml&quot;</span>);
      boost::archive::xml_oarchive oa(f); <span class="comment">// set up an xml archive</span>
      oa &lt;&lt; BOOST_SERIALIZATION_NVP(r);   <span class="comment">// save r to xml file rand.xml</span>
    }
    <a class="code" href="classRandomLib_1_1RandomCanonical.html" title="Generate random integers, reals, and booleans.">RandomLib::Random</a> s(0);
    {
      std::ifstream f(<span class="stringliteral">&quot;rand.xml&quot;</span>);
      boost::archive::xml_iarchive ia(f);
      ia &gt;&gt; BOOST_SERIALIZATION_NVP(s); <span class="comment">// load saved state to s</span>
    }
    r.StepCount(step); s.StepCount(step); <span class="comment">// step both generators forward</span>
    std::cout &lt;&lt; (r == s &amp;&amp; r() == s()
                  ? <span class="stringliteral">&quot;succeeded\n&quot;</span> : (retval = 1, <span class="stringliteral">&quot;failed\n&quot;</span>));
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    std::cout &lt;&lt; <span class="stringliteral">&quot;Skipping boost tests\n&quot;</span>;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>  }
  <span class="keywordflow">return</span> retval;
}
</pre></div><p>As you can see in this example, you can use Boost serialization to save and restore the state of a Random object to various types of archives provided you have the Boost serialization library installed (see <a href="http://www.boost.org">http://www.boost.org</a>). To turn this feature on, compile any code which includes <a class="el" href="Random_8hpp.html" title="Header for Random, RandomGenerator.">RandomLib/Random.hpp</a> with HAVE_BOOST_SERIALIZATION defined to be 1, and link the resulting code with libboost_serialization. In order to declare the boost archives, you will need to include the appropriate header file, e.g., </p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">  #include &lt;boost/archive/xml_iarchive.hpp&gt;</span>
<span class="preprocessor">  #include &lt;boost/archive/xml_oarchive.hpp&gt;</span>
</pre></div><center> Back to <a class="el" href="otherdist.html">Other random distributions</a>. Forward to <a class="el" href="programming.html">Programming tips</a>. Up to <a class="el" href="index.html#contents">Contents</a>. </center> </div></div>
<hr class="footer"/><address class="footer"><small>Generated on Sat Jan 21 2012 for RandomLib by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
